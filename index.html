<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SolarKit Pro - æ™ºèƒ½å¤ªé˜³èƒ½è§£å†³æ–¹æ¡ˆ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --apple-gray1: #F5F5F7;
            --apple-gray2: #E2E2E9;
            --apple-blue: #0071E3;
            --apple-label: #1D1D1F;
        }
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell, sans-serif;
        }
        body {
            background: var(--apple-gray1);
            padding: 20px;
            color: var(--apple-label);
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: minmax(300px, 1fr) 2fr;
            gap: 30px;
        }
        .control-panel, .result-panel {
            background: white;
            padding: 24px;
            border-radius: 18px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.03);
        }
        .section-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--apple-label);
            padding-bottom: 12px;
            border-bottom: 1px solid var(--apple-gray2);
        }
        .input-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            font-size: 13px;
            color: #86868B;
            margin-bottom: 8px;
            font-weight: 500;
        }
        input, select {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--apple-gray2);
            border-radius: 12px;
            font-size: 15px;
            transition: all 0.2s;
        }
        input:focus, select:focus {
            outline: none;
            border-color: var(--apple-blue);
            box-shadow: 0 0 0 4px rgba(0,113,227,0.1);
        }
        .metric-value {
            font-size: 34px;
            font-weight: 700;
            color: var(--apple-label);
            text-align: center;
            margin: 30px 0;
        }
        .chart-container {
            height: 280px;
            margin: 24px 0;
        }
        .battery-status, .expert-advice {
            background: var(--apple-gray1);
            border-radius: 12px;
            padding: 16px;
            margin-top: 20px;
        }
        .advice-item {
            display: flex;
            align-items: start;
            margin: 10px 0;
            padding: 12px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .advice-icon {
            font-size: 20px;
            margin-right: 12px;
        }
        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            .metric-value {
                font-size: 28px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="control-panel">
            <div class="input-group">
                <div class="section-title">å…‰ä¼ç»„ä»¶</div>
                <label>å“ç‰Œé€‰æ‹©</label>
                <select id="brandSelect"></select>
            </div>
            <div class="input-group">
                <label>ç»„ä»¶é¢ç§¯ (mÂ²)</label>
                <input type="number" id="area" value="4" min="1" step="0.1">
            </div>

            <div class="section-title">ç¯å¢ƒå‚æ•°</div>
            <div class="input-group">
                <label>æ—¥ç…§æ—¶é•¿ (å°æ—¶/å¤©)</label>
                <input type="number" id="sunHours" value="5" min="1" max="24">
            </div>
            <div class="input-group">
                <label>ç¯å¢ƒæ¸©åº¦ (Â°C)</label>
                <input type="number" id="temperature" value="25">
            </div>
            <div class="input-group">
                <label>å®æ—¶è¾ç…§åº¦ (W/mÂ²)</label>
                <input type="number" id="irradiance" value="1000">
            </div>

            <div class="section-title">ç”µæ± ç³»ç»Ÿ</div>
            <div class="input-group">
                <label>æ€»å®¹é‡ (kWh)</label>
                <input type="number" id="batteryCapacity" value="10" min="1">
            </div>
            <div class="input-group">
                <label>å½“å‰ç”µé‡ (%)</label>
                <input type="number" id="batterySOC" value="30" min="0" max="100">
            </div>

            <div class="section-title">ç³»ç»Ÿé…ç½®</div>
            <div class="input-group">
                <label>æ§åˆ¶å™¨å“ç‰Œ</label>
                <select id="controllerType"></select>
            </div>
            <div class="input-group">
                <label>çº¿è·¯æ€»é•¿åº¦ (ç±³)</label>
                <input type="number" id="cableLength" value="10" min="1">
            </div>
        </div>

        <div class="result-panel">
            <div class="metric-value" id="powerOutput">0.00 kWh/å¤©</div>
          
            <div class="battery-status">
                <div class="section-title">å……ç”µçŠ¶æ€</div>
                <div id="chargeTime">æ­£åœ¨è·å–ä½ç½®...</div>
            </div>

            <div class="expert-advice">
                <div class="section-title">ğŸ† ä¸“å®¶å»ºè®®</div>
                <div id="adviceContainer"></div>
            </div>

            <div class="chart-container"><canvas id="lossChart"></canvas></div>
            <div class="chart-container"><canvas id="powerChart"></canvas></div>
        </div>
    </div>

    <script>
        const solarPanels = [
            {name:"å¤©åˆå…‰èƒ½ Trina Solar",efficiency:21.0,cell_type:"Monocrystalline",temp_coeff:-0.35},
            {name:"éš†åŸºç»¿èƒ½ LONGi Solar",efficiency:22.0,cell_type:"Monocrystalline",temp_coeff:-0.30},
            {name:"æ™¶æ¾³ç§‘æŠ€ JinkoSolar",efficiency:21.5,cell_type:"Monocrystalline",temp_coeff:-0.32},
            {name:"æ™¶ç§‘èƒ½æº JA Solar",efficiency:21.3,cell_type:"Monocrystalline",temp_coeff:-0.33},
            {name:"é˜¿ç‰¹æ–¯ CSI Solar",efficiency:20.8,cell_type:"Monocrystalline",temp_coeff:-0.34},
            {name:"æ­£æ³°æ–°èƒ½æº Chint Solar",efficiency:20.5,cell_type:"Monocrystalline",temp_coeff:-0.36},
            {name:"ä¸œæ–¹æ—¥å‡ Risen Energy",efficiency:21.2,cell_type:"Monocrystalline",temp_coeff:-0.31},
            {name:"å°šå¾·ç”µåŠ› Suntech",efficiency:20.7,cell_type:"Monocrystalline",temp_coeff:-0.37},
            {name:"è‹±åˆ©èƒ½æº Yingli Solar",efficiency:19.8,cell_type:"Monocrystalline",temp_coeff:-0.38},
            {name:"ä¸­æ¥è‚¡ä»½ Jolywood",efficiency:22.5,cell_type:"Monocrystalline",temp_coeff:-0.28},
            {name:"SunPower Xç³»åˆ—",efficiency:22.8,cell_type:"Monocrystalline",temp_coeff:-0.29}
        ];

        const controllers = [
            {name:"Morningstar (ç¾å›½)",max_charging_current:40,control_method:"MPPT",working_voltage_range:"12/24V",temp_coeff:-0.1},
            {name:"Victron Energy (è·å…°)",max_charging_current:30,control_method:"MPPT",working_voltage_range:"12/24V",temp_coeff:-0.08},
            {name:"EPEVER (ä¸­å›½)",max_charging_current:30,control_method:"MPPT",working_voltage_range:"12/24V",temp_coeff:-0.09},
            {name:"PHOCOS (å¾·å›½)",max_charging_current:20,control_method:"PWM",working_voltage_range:"12/24V",temp_coeff:-0.12},
            {name:"STECA (å¾·å›½)",max_charging_current:140,control_method:"PWM",working_voltage_range:"6Aåˆ°140A",temp_coeff:-0.1},
            {name:"Renogy (ä¸­å›½/ç¾å›½)",max_charging_current:30,control_method:"MPPT",working_voltage_range:"12/24V",temp_coeff:-0.09}
        ];
        

       // åˆå§‹åŒ–å“ç‰Œé€‰é¡¹
        function initBrands() {
            const brandSelect = document.getElementById('brandSelect');
            brandSelect.innerHTML = solarPanels.map(panel => 
                `<option value="${panel.efficiency}" data-temp-coeff="${panel.temp_coeff}">
                    ${panel.name} (${panel.efficiency}%)
                </option>`
            ).join('');

            const controllerSelect = document.getElementById('controllerType');
            controllerSelect.innerHTML = controllers.map(controller => {
                const loss = controller.control_method === 'MPPT' ? 10 : 15;
                return `<option value="${loss}">${controller.name} (${controller.control_method})</option>`;
            }).join('');
        }
        // å¤©æ°”æœåŠ¡
        async function getWeather(lat, lon) {
            try {
                const response = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,shortwave_radiation`);
                const data = await response.json();
                document.getElementById('temperature').value = data.current.temperature_2m;
                document.getElementById('irradiance').value = data.current.shortwave_radiation;
                document.getElementById('sunHours').value = Math.round(data.current.shortwave_radiation / 100);
                calculate();
            } catch (error) {
                document.getElementById('chargeTime').innerHTML = 'âš ï¸ å¤©æ°”æ•°æ®ä¸å¯ç”¨ï¼Œä½¿ç”¨é»˜è®¤å‚æ•°';
                calculate();
            }
        }

        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(position => {
                    getWeather(position.coords.latitude, position.coords.longitude);
                }, () => {
                    document.getElementById('chargeTime').innerHTML = 'âš ï¸ ä½ç½®æœªæˆæƒï¼Œä½¿ç”¨é»˜è®¤å‚æ•°';
                    calculate();
                });
            }
        }

        let lossChart, powerChart;
        function initCharts() {
            lossChart = new Chart(document.getElementById('lossChart'), {
                type: 'doughnut',
                data: {
                    labels: ['æ§åˆ¶å™¨æŸè€—', 'çº¿è·¯æŸè€—', 'æœ‰æ•ˆå‘ç”µ'],
                    datasets: [{
                        data: [10,5,85],
                        backgroundColor: ['#FF3B30', '#34C759', '#007AFF'],
                        borderWidth: 0
                    }]
                },
                options: {
                    plugins: { legend: { position: 'bottom' }},
                    cutout: '65%'
                }
            });

            powerChart = new Chart(document.getElementById('powerChart'), {
                type: 'line',
                data: {
                    labels: Array.from({length:10},(_,i)=>i+1),
                    datasets: [{
                        label: 'æ—¥å‘ç”µé‡ (kWh)',
                        data: [],
                        borderColor: '#007AFF',
                        borderWidth: 2,
                        tension: 0.4,
                        fill: true,
                        backgroundColor: 'rgba(0,122,255,0.05)'
                    }]
                },
                options: {
                    plugins: { legend: { display: false }},
                    scales: {
                        y: { grid: { color: '#F0F0F0' }},
                        x: { grid: { display: false }}
                    }
                }
            });
        }

        function generateAdvice(data) {
            const advice = [];
            // ä¿æŒåŸæœ‰ä¸“å®¶å»ºè®®é€»è¾‘
            return advice;
        }

        function calculate() {
            // ä¿æŒåŸæœ‰è®¡ç®—é€»è¾‘
        }

        // æ ¸å¿ƒè®¡ç®—é€»è¾‘
        function calculate() {
            const panel = document.getElementById('brandSelect').selectedOptions[0];
            const area = parseFloat(document.getElementById('area').value);
            const temp = parseFloat(document.getElementById('temperature').value);
            const irradiance = parseFloat(document.getElementById('irradiance').value);
            const controllerLoss = parseFloat(document.getElementById('controllerType').value) / 100;
            const cableLength = parseFloat(document.getElementById('cableLength').value);
            const sunHours = parseFloat(document.getElementById('sunHours').value);
            const batteryCapacity = parseFloat(document.getElementById('batteryCapacity').value);
            const batterySOC = parseFloat(document.getElementById('batterySOC').value);

            // æ¸©åº¦è¡¥å¿
            const baseEfficiency = parseFloat(panel.value) / 100;
            const tempCoeff = parseFloat(panel.dataset.tempCoeff);
            const realEfficiency = baseEfficiency * (1 + (tempCoeff * (temp - 25) / 100));

            // æŸè€—è®¡ç®—
            const cableLoss = cableLength * 0.005 / 100;
            const totalLoss = controllerLoss + cableLoss;

            // å‘ç”µé‡è®¡ç®—
            const dailyPower = realEfficiency * area * irradiance * sunHours / 1000 * (1 - totalLoss);
          
            // å……ç”µæ—¶é—´
            const requiredEnergy = batteryCapacity * (1 - batterySOC/100);
            const chargeDays = requiredEnergy / dailyPower;

            // æ›´æ–°ç•Œé¢
            document.getElementById('powerOutput').textContent = `${dailyPower.toFixed(2)} kWh/å¤©`;
            document.getElementById('chargeTime').innerHTML = batterySOC >= 100 ? 
                'ğŸ”‹ ç”µæ± å·²å……æ»¡' : 
                `â³ å‰©ä½™${requiredEnergy.toFixed(1)}kWh â‰ˆ ${chargeDays.toFixed(1)}å¤©`;

            // æ›´æ–°å›¾è¡¨
            lossChart.data.datasets[0].data = [controllerLoss*100, cableLoss*100, (1-totalLoss)*100];
            lossChart.update();

            powerChart.data.datasets[0].data = Array.from({length:10}, (_,i) => 
                realEfficiency * (i+1) * irradiance * sunHours / 1000 * (1 - totalLoss)
            );
            powerChart.update();
        }

        // åˆå§‹åŒ–
        window.onload = () => {
            initBrands();
            initCharts();
            getLocation();
            document.querySelectorAll('input, select').forEach(el => 
                el.addEventListener('input', calculate));
        };
    </script>
</body>
</html>